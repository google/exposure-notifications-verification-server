{{define "index"}}
<html>
<head>
  <title>{{.title}}</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <style>
  .container {
    max-width: 960px;
  }

  .border-top { border-top: 1px solid #e5e5e5; }
  .border-bottom { border-bottom: 1px solid #e5e5e5; }
  .border-top-gray { border-top-color: #adb5bd; }

  .box-shadow { box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05); }

  .lh-condensed { line-height: 1.25; }
  </style>

  {{template "firebase" .}}

  <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
  <script type="text/javascript">
  // FirebaseUI config.
  var uiConfig = {
    'callbacks': {
      // Called when the user has been successfully signed in.
      'signInSuccess': function(user, credential, redirectUrl) {
        user.getIdToken().then(
          idToken => {
            const csrfToken = getCookie('csrfToken')
            $.ajax({
              type:'POST',
              url: "/session",
              data: {idToken: idToken, csrfToken: csrfToken},
              contentType: 'application/x-www-form-urlencoded',
              success: function(returnData) {
                window.location.assign('/home');
              },
              error: function(xhr, status, error) {
                window.location.assign(encodeURI("/signout?reason=" + error));
              }
            })
          })
        return false
      }
    },
    'credentialHelper': firebaseui.auth.CredentialHelper.NONE,
  	signInOptions: [
  		firebase.auth.EmailAuthProvider.PROVIDER_ID
  	],
  	// tosUrl and privacyPolicyUrl accept either url string or a callback
  	// function.
  	// Terms of service url/callback.
  	tosUrl: 'http://example.com',
  	// Privacy policy url/callback.
  	privacyPolicyUrl: function() {
  		window.location.assign('http://example.com');
  	}
  };

  // Initialize the FirebaseUI Widget using Firebase.
  firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE)
  var ui = new firebaseui.auth.AuthUI(firebase.auth());

  function getCookie(name) {
    var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
    return v ? v[2] : null;
  }

  window.addEventListener('load', function() {
    // The start method will wait until the DOM is loaded.
    ui.start('#firebaseui-auth-container', uiConfig);
  });
</script>

</head>

<body class="bg-light">

  <div class="container">
   <div class="row">
    <div class="py-5 text-center">
      <h2>Login to {{.name}}</h2>
    </div>
   </div>

   <div class="row">
    <div class="col">
      <div id="firebaseui-auth-container"></div>
    </div>
   </div>
  </div>

</body>
</html>

{{end}}

{{define "report/index"}}

{{$currentRealm := .realm}}

<!doctype html>
<html dir="{{$.textDirection}}" lang="{{$.textLanguage}}">
<head>
  {{template "report/head" .}}
</head>

<body class="tab-content">
  <main role="main" class="container">
    <h1>Request exposure notifications verification code from {{.realm.Name}} ({{.realm.RegionCode}})</h1>

    <form method="POST" action="/report/issue" class="floating-form">
      {{ .csrfField }}

      <div id="form-area">

        <div class="card mb-3 shadow-sm">
          <div class="card-header">Enter the date of your COVID-19 test</div>
          <div class="card-body">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="testDate">{{t $.locale "codes.issue.testing-date-label"}}</label>
                <input type="date" id="test-date" name="testDate" min="{{.minDate}}" max="{{.maxDate}}" class="form-control" {{if $currentRealm.RequireDate}}required{{end}} />
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3 shadow-sm">
          <div class="card-header">Enter the date of your COVID-19 symptoms</div>
          <div class="card-body">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="symptomDate">Leave blank if you have not experienced symptoms</label>
                <div class="input-group">
                  <input type="date" id="symptom-date" name="symptomDate" min="{{.minDate}}" max="{{.maxDate}}" class="form-control" {{if $currentRealm.RequireDate}}required{{end}} />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3 shadow-sm">
          <div class="card-header">Phone Number</div>
          <div class="card-body">            
            <div class="form-row">
              <label for="phone">Enter your mobile phone number. Your Exposure Notifications
                verification code from {{.realm.Name}} will be send to you via text message.
              </label>
            </div>
            <div class="form-row">
              <div class="input-group">
                <input type="tel" id="phone" name="phone" class="form-control" autocomplete="off" class="w-100" />
              </div>              
            </div>
          </div>
        </div>

        <div class="card mb-3 shadow-sm">
          <div class="card-header">Test Agreement</div>
          <div class="card-body">            
            <div class="form-row">
              <div class="form-check mb-3">                
                 <input type="checkbox" name="agreement" id="agreement" class="form-check-input" value="true" />
                 <label for="agreement" class="form-check-label">
                   I agree that I have received a positive test result for COVID-19, that the phone
                   number provided belongs to me, and that I would like to receive a verification code
                   for Exposure Notifications to share my information anonymously with others. 
                 </label>              
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <button id="submit" type="submit" class="btn btn-primary btn-block">{{t $.locale "codes.issue.create-code-button"}}</button>
          </div>
        </div>
      </div>
    </form>
  </main>

  <script type="text/javascript">
    // Initialize pretty phone
    let phone = document.querySelector('#phone');
    let iti = window.intlTelInput(phone, {
      nationalMode: true,
      {{- if $currentRealm.SMSCountry }}
      initialCountry: '{{$currentRealm.SMSCountry}}',
      {{- end }}
      utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.0/js/utils.js',
    });

    {{if $currentRealm.RequireDate}}
      let $dates = $('input#test-date,input#symptom-date');
      $dates.on('input', function() {
        $dates.not(this).prop('required', !$(this).val().length);
      });
      {{end}}
  </script>

</body>
</html>
{{end}}
